<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="app-shell">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="{{ url_for('static', filename='assets/GrandGuard.png') }}"
             alt="GrantGuard logo" class="logo-img" />
        <span class="brand-text">GrantGuard</span>
      </div>
      <nav class="menu">
        <a class="active" href="/dashboard">Dashboard</a>
        <a href="/awards/new">Generate Grants</a>
        <a href="/policies/university">Policies</a>
        <a href="/subawards">Subawards</a>
        <a href="/settings">Settings</a>
        <a href="/profile">Profile</a>
        <a href="/logout">Log out</a>
      </nav>
    </aside>

    <!-- Main content -->
    <main class="content">
      <h2>Welcome, {{ name }}!</h2>

      <section class="card" style="margin-top:24px;">
        <h3>Available Budgets</h3>

        {% if awards and awards|length > 0 %}
          <table class="budget-table">
            <thead>
              <tr>
                <th>Grant Name</th>
                <th>Date Created</th>
                <th>Funding Agency</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
            {% for a in awards %}
              <tr>
                <td>{{ a.title }}</td>
                <td>{{ a.created_at.date() if a.created_at is not none else '' }}</td>
                <td>{{ a.sponsor_type or 'N/A' }}</td>
                <td>{{ a.start_date }}</td>
                <td>{{ a.end_date }}</td>
                <td>{{ a.status }}</td>
                <td>
                    {# View is always allowed #}
                    <a class="btn-small-info"
                        href="{{ url_for('award_view', award_id=a.award_id) }}">
                        View
                    </a>

                    {# Only show Edit + Submit while status is Draft #}
                    {% if a.status == 'Draft' %}
                        <a class="btn-small-warning"
                        href="{{ url_for('award_edit', award_id=a.award_id) }}">
                        Edit
                        </a>

                        <form method="post"
                            action="{{ url_for('award_submit', award_id=a.award_id) }}"
                            style="display:inline;">
                        <button type="submit" class="btn-small-primary">
                            Submit
                        </button>
                        </form>
                    {% endif %}

                    {# Delete â€“ keep available always (or you can also wrap in an if) #}
                    <form method="post"
                            action="{{ url_for('award_delete', award_id=a.award_id) }}"
                            style="display:inline;">
                        <button type="submit" class="btn-small-danger">
                        Delete
                        </button>
                    </form>
                    </td>

              </tr>
            {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p>No grants yet.
            <a href="{{ url_for('awards_new') }}">Create your first grant</a>.
          </p>
        {% endif %}
      </section>
    </main>
  </div>
  <script src="{{ url_for('static', filename='theme.js') }}"></script>
</body>
</html>
