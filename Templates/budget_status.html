<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Budget Status - GrantGuard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="{{ url_for('static', filename='assets/GrandGuard.png') }}" alt="GrantGuard logo" class="logo-img" />
        <span class="brand-text">GrantGuard</span>
      </div>
      <nav class="menu">
        <a href="/dashboard">Dashboard</a>
        {% if user.role != 'Admin' %}
        <a href="/awards/new">Generate Grants</a>
        {% endif %}
        <a href="/policies/university">Policies</a>
        <a href="/subawards">Subawards</a>
        <a href="/settings">Settings</a>
        <a href="/profile">Profile</a>
        <a href="/logout">Log out</a>
      </nav>
    </aside>
    <main class="content">
      <header style="margin-bottom: 24px; display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <a class="back-link" href="{{ url_for('award_view', award_id=award.award_id) }}">‚Üê Back to Award</a>
          <h1 style="margin: 8px 0 0 0; font-size: 1.75em; font-weight: 700; color: var(--gg-text-main);">Budget Status</h1>
          <p style="margin: 8px 0 0 0; font-size: 0.875em; color: #6b7280;">{{ award.title }}</p>
        </div>
        <div style="display: flex; gap: 12px;">
          {% if user.role != 'Admin' %}
          <a href="{{ url_for('transaction_new', award_id=award.award_id) }}" class="btn">New Transaction</a>
          {% endif %}
          <a href="{{ url_for('transactions_list', award_id=award.award_id) }}" class="btn" style="background: #6b7280;">View Transactions</a>
        </div>
      </header>

      <!-- Total Award Amount Header -->
      <div class="card" style="margin-bottom: 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <div style="font-size: 0.875em; opacity: 0.9; margin-bottom: 8px;">Total Award Amount</div>
            <div style="font-size: 2.5em; font-weight: 700;">${{ '{:,.2f}'.format(total_award_amount) }}</div>
          </div>
          <div style="text-align: center; flex: 1;">
            <div style="font-size: 0.875em; opacity: 0.9; margin-bottom: 8px;">Remaining Budget</div>
            <div style="font-size: 2.5em; font-weight: 700;">${{ '{:,.2f}'.format(remaining_budget) }}</div>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 0.875em; opacity: 0.9; margin-bottom: 4px;">Spent</div>
            <div style="font-size: 1.5em; font-weight: 600;">${{ '{:,.2f}'.format(totals.spent) }}</div>
            <div style="font-size: 0.875em; opacity: 0.9; margin-top: 4px;">Committed: ${{ '{:,.2f}'.format(totals.committed) }}</div>
          </div>
        </div>
      </div>

      <!-- Category Boxes (Vertical Layout) -->
      <div style="display: flex; flex-direction: column; gap: 20px;">
        
        <!-- Personnel Expenses -->
        <div class="card">
          <h3 style="margin: 0 0 8px 0; font-size: 1.25em; font-weight: 600; color: var(--gg-text-main);">Personnel Expenses</h3>
          <div style="font-size: 1.125em; font-weight: 600; color: #0b84f3; margin-bottom: 16px;">
            Total Estimated: ${{ '{:,.2f}'.format(budget_status.get('Personnel', {}).get('allocated', 0)) }}
          </div>
          
          {% if personnel_items and personnel_items|length > 0 %}
          <div style="margin-bottom: 16px;">
            {% for item in personnel_items %}
            <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 600; color: var(--gg-text-main);">{{ item.name }}</div>
                <div style="font-size: 0.875em; color: #6b7280;">{{ item.position }}</div>
              </div>
              <div style="font-weight: 600; color: #0b84f3;">${{ '{:,.2f}'.format(item.amount) }}</div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 16px; color: #6b7280; text-align: center;">
            No personnel expenses recorded
          </div>
          {% endif %}
          
          <div style="border-top: 2px solid #e5e7eb; padding-top: 16px; margin-top: 16px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
              <div style="padding: 16px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #ef4444;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Spent Amount</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #ef4444;">${{ '{:,.2f}'.format(budget_status.get('Personnel', {}).get('spent', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Committed</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #f59e0b;">${{ '{:,.2f}'.format(budget_status.get('Personnel', {}).get('committed', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Remaining Budget</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #10b981;">${{ '{:,.2f}'.format(budget_status.get('Personnel', {}).get('remaining', 0)) }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Travel Expenses -->
        <div class="card">
          <h3 style="margin: 0 0 8px 0; font-size: 1.25em; font-weight: 600; color: var(--gg-text-main);">Travel Expenses</h3>
          <div style="font-size: 1.125em; font-weight: 600; color: #0b84f3; margin-bottom: 16px;">
            Total Estimated: ${{ '{:,.2f}'.format(budget_status.get('Travel', {}).get('allocated', 0)) }}
          </div>
          
          {% if travel_items and travel_items|length > 0 %}
          <div style="margin-bottom: 16px;">
            {% for item in travel_items %}
            <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 600; color: var(--gg-text-main);">{{ item.description }}</div>
                <div style="font-size: 0.875em; color: #6b7280;">{{ item.type }}</div>
              </div>
              <div style="font-weight: 600; color: #0b84f3;">${{ '{:,.2f}'.format(item.amount) }}</div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 16px; color: #6b7280; text-align: center;">
            No travel expenses recorded
          </div>
          {% endif %}
          
          <div style="border-top: 2px solid #e5e7eb; padding-top: 16px; margin-top: 16px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
              <div style="padding: 16px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #ef4444;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Spent Amount</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #ef4444;">${{ '{:,.2f}'.format(budget_status.get('Travel', {}).get('spent', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Committed</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #f59e0b;">${{ '{:,.2f}'.format(budget_status.get('Travel', {}).get('committed', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Remaining Budget</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #10b981;">${{ '{:,.2f}'.format(budget_status.get('Travel', {}).get('remaining', 0)) }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Equipment -->
        <div class="card">
          <h3 style="margin: 0 0 8px 0; font-size: 1.25em; font-weight: 600; color: var(--gg-text-main);">Equipment</h3>
          <div style="font-size: 1.125em; font-weight: 600; color: #0b84f3; margin-bottom: 16px;">
            Total Estimated: ${{ '{:,.2f}'.format(budget_status.get('Equipment', {}).get('allocated', 0)) }}
          </div>
          
          {% if equipment_items and equipment_items|length > 0 %}
          <div style="margin-bottom: 16px;">
            {% for item in equipment_items %}
            <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
              <div style="font-weight: 600; color: var(--gg-text-main);">{{ item.description }}</div>
              <div style="font-weight: 600; color: #0b84f3;">${{ '{:,.2f}'.format(item.amount) }}</div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 16px; color: #6b7280; text-align: center;">
            No equipment expenses recorded
          </div>
          {% endif %}
          
          <div style="border-top: 2px solid #e5e7eb; padding-top: 16px; margin-top: 16px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
              <div style="padding: 16px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #ef4444;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Spent Amount</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #ef4444;">${{ '{:,.2f}'.format(budget_status.get('Equipment', {}).get('spent', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Committed</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #f59e0b;">${{ '{:,.2f}'.format(budget_status.get('Equipment', {}).get('committed', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Remaining Budget</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #10b981;">${{ '{:,.2f}'.format(budget_status.get('Equipment', {}).get('remaining', 0)) }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Materials and Supplies -->
        <div class="card">
          <h3 style="margin: 0 0 8px 0; font-size: 1.25em; font-weight: 600; color: var(--gg-text-main);">Materials and Supplies</h3>
          <div style="font-size: 1.125em; font-weight: 600; color: #0b84f3; margin-bottom: 16px;">
            Total Estimated: ${{ '{:,.2f}'.format(budget_status.get('Materials', {}).get('allocated', 0)) }}
          </div>
          
          {% if materials_items and materials_items|length > 0 %}
          <div style="margin-bottom: 16px;">
            {% for item in materials_items %}
            <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
              <div style="font-weight: 600; color: var(--gg-text-main);">{{ item.description }}</div>
              <div style="font-weight: 600; color: #0b84f3;">${{ '{:,.2f}'.format(item.amount) }}</div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 16px; color: #6b7280; text-align: center;">
            No materials/supplies expenses recorded
          </div>
          {% endif %}
          
          <div style="border-top: 2px solid #e5e7eb; padding-top: 16px; margin-top: 16px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
              <div style="padding: 16px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #ef4444;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Spent Amount</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #ef4444;">${{ '{:,.2f}'.format(budget_status.get('Materials', {}).get('spent', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Committed</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #f59e0b;">${{ '{:,.2f}'.format(budget_status.get('Materials', {}).get('committed', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Remaining Budget</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #10b981;">${{ '{:,.2f}'.format(budget_status.get('Materials', {}).get('remaining', 0)) }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Other Direct Costs -->
        <div class="card">
          <h3 style="margin: 0 0 8px 0; font-size: 1.25em; font-weight: 600; color: var(--gg-text-main);">Other Direct Costs</h3>
          <div style="font-size: 1.125em; font-weight: 600; color: #0b84f3; margin-bottom: 16px;">
            Total Estimated: ${{ '{:,.2f}'.format(budget_status.get('Other Direct Costs', {}).get('allocated', 0)) }}
          </div>
          
          {% if other_costs_items and other_costs_items|length > 0 %}
          <div style="margin-bottom: 16px;">
            {% for item in other_costs_items %}
            <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
              <div style="font-weight: 600; color: var(--gg-text-main);">{{ item.description }}</div>
              <div style="font-weight: 600; color: #0b84f3;">${{ '{:,.2f}'.format(item.amount) }}</div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 16px; color: #6b7280; text-align: center;">
            No other direct costs recorded
          </div>
          {% endif %}
          
          <div style="border-top: 2px solid #e5e7eb; padding-top: 16px; margin-top: 16px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
              <div style="padding: 16px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #ef4444;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Spent Amount</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #ef4444;">${{ '{:,.2f}'.format(budget_status.get('Other Direct Costs', {}).get('spent', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Committed</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #f59e0b;">${{ '{:,.2f}'.format(budget_status.get('Other Direct Costs', {}).get('committed', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Remaining Budget</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #10b981;">${{ '{:,.2f}'.format(budget_status.get('Other Direct Costs', {}).get('remaining', 0)) }}</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Subawards -->
        <div class="card">
          <h3 style="margin: 0 0 8px 0; font-size: 1.25em; font-weight: 600; color: var(--gg-text-main);">Subawards</h3>
          <div style="font-size: 1.125em; font-weight: 600; color: #0b84f3; margin-bottom: 16px;">
            Total Amount: ${{ '{:,.2f}'.format(budget_status.get('Subawards', {}).get('allocated', 0)) }}
          </div>
          
          {% if subawards_list and subawards_list|length > 0 %}
          <div style="margin-bottom: 16px;">
            {% for sub in subawards_list %}
            <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 600; color: var(--gg-text-main);">{{ sub.subrecipient_name }}</div>
                <div style="font-size: 0.875em; color: #6b7280;">Status: {{ sub.status }}</div>
              </div>
              <div style="font-weight: 600; color: #0b84f3;">${{ '{:,.2f}'.format(sub.amount) }}</div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div style="padding: 12px; background: #f9fafb; border-radius: 8px; margin-bottom: 16px; color: #6b7280; text-align: center;">
            No subawards created yet
          </div>
          {% endif %}
          
          <div style="border-top: 2px solid #e5e7eb; padding-top: 16px; margin-top: 16px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
              <div style="padding: 16px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #ef4444;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Spent Amount</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #ef4444;">${{ '{:,.2f}'.format(budget_status.get('Subawards', {}).get('spent', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Committed</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #f59e0b;">${{ '{:,.2f}'.format(budget_status.get('Subawards', {}).get('committed', 0)) }}</div>
              </div>
              <div style="padding: 16px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981;">
                <div style="font-size: 0.875em; color: #6b7280; margin-bottom: 4px;">Remaining Budget</div>
                <div style="font-size: 1.5em; font-weight: 700; color: #10b981;">${{ '{:,.2f}'.format(budget_status.get('Subawards', {}).get('remaining', 0)) }}</div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>
  <script src="{{ url_for('static', filename='theme.js') }}"></script>
</body>
</html>
