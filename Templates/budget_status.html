<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Budget Status - GrantGuard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="{{ url_for('static', filename='assets/GrandGuard.png') }}" alt="GrantGuard logo" class="logo-img" />
        <span class="brand-text">GrantGuard</span>
      </div>
      <nav class="menu">
        <a href="/dashboard">Dashboard</a>
        <a href="/awards/new">Generate Grants</a>
        <a href="/policies/university">Policies</a>
        <a href="/subawards">Subawards</a>
        <a href="/settings">Settings</a>
        <a href="/profile">Profile</a>
        <a href="/logout">Log out</a>
      </nav>
    </aside>
    <main class="content">
      <header style="margin-bottom: 24px; display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
          <a class="back-link" href="{{ url_for('award_view', award_id=award.award_id) }}">← Back to Award</a>
          <h1 style="margin: 8px 0 0 0; font-size: 1.75em; font-weight: 700; color: var(--gg-text-main);">Budget Status</h1>
          <p style="margin: 8px 0 0 0; font-size: 0.875em; color: #6b7280;">{{ award.title }}</p>
        </div>
        <div style="display: flex; gap: 12px;">
          <a href="{{ url_for('transaction_new', award_id=award.award_id) }}" class="btn">New Transaction</a>
          <a href="{{ url_for('transactions_list', award_id=award.award_id) }}" class="btn" style="background: #6b7280;">View Transactions</a>
        </div>
      </header>

      <!-- Summary Cards -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 24px;">
        <div class="card stat-card">
          <div class="stat-content">
            <span class="stat-label">Total Allocated</span>
            <strong class="stat-value">${{ '{:,.2f}'.format(totals.allocated) }}</strong>
          </div>
        </div>
        <div class="card stat-card">
          <div class="stat-content">
            <span class="stat-label">Spent</span>
            <strong class="stat-value" style="color: #10b981;">${{ '{:,.2f}'.format(totals.spent) }}</strong>
          </div>
        </div>
        <div class="card stat-card">
          <div class="stat-content">
            <span class="stat-label">Committed</span>
            <strong class="stat-value" style="color: #f59e0b;">${{ '{:,.2f}'.format(totals.committed) }}</strong>
          </div>
        </div>
        <div class="card stat-card">
          <div class="stat-content">
            <span class="stat-label">Remaining</span>
            <strong class="stat-value" style="color: #0b84f3;">${{ '{:,.2f}'.format(totals.remaining) }}</strong>
          </div>
        </div>
      </div>

      <!-- Budget by Category -->
      <div class="card">
        <h3 style="margin: 0 0 20px 0; font-size: 1.125em; font-weight: 600; color: var(--gg-text-main);">Budget by Category</h3>
        {% if budget_status %}
        <div class="history-table-wrapper">
          <table class="history-table">
            <thead>
              <tr>
                <th>Category</th>
                <th>Allocated</th>
                <th>Spent</th>
                <th>Committed</th>
                <th>Remaining</th>
                <th>% Used</th>
              </tr>
            </thead>
            <tbody>
              {% for category, budget in budget_status.items() %}
              <tr>
                <td style="font-weight: 600;">{{ category }}</td>
                <td>${{ '{:,.2f}'.format(budget.allocated) }}</td>
                <td style="color: #10b981;">${{ '{:,.2f}'.format(budget.spent) }}</td>
                <td style="color: #f59e0b;">${{ '{:,.2f}'.format(budget.committed) }}</td>
                <td style="color: #0b84f3; font-weight: 600;">${{ '{:,.2f}'.format(budget.remaining) }}</td>
                <td>
                  {% if budget.allocated > 0 %}
                    {% set percent = ((budget.spent + budget.committed) / budget.allocated * 100) | round(1) %}
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <div style="flex: 1; height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                        <div style="height: 100%; width: {{ percent }}%; background: {% if percent > 90 %}#ef4444{% elif percent > 75 %}#f59e0b{% else %}#0b84f3{% endif %};"></div>
                      </div>
                      <span style="font-size: 0.875em; min-width: 45px; text-align: right;">{{ percent }}%</span>
                    </div>
                  {% else %}
                    <span style="color: #9ca3af;">—</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div style="text-align: center; padding: 40px 20px; color: #6b7280;">
          <p>No budget lines found. Budget will be initialized when first transaction is created.</p>
        </div>
        {% endif %}
      </div>
    </main>
  </div>
  <script src="{{ url_for('static', filename='theme.js') }}"></script>
</body>
</html>
